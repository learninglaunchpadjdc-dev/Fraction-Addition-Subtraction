<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Addition and Subtraction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap');
        
        body { font-family: 'JetBrains Mono', monospace; }
        
        .blueprint-grid {
            background-image: linear-gradient(#334155 1px, transparent 1px), linear-gradient(90deg, #334155 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .step-hidden { display: none; }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .animate-flicker {
            animation: flicker 2s infinite;
        }
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-[#0f141e] text-slate-300 min-h-screen selection:bg-amber-500/30">

    <div class="fixed inset-0 pointer-events-none opacity-10 blueprint-grid"></div>

    <div class="max-w-5xl mx-auto relative z-10 p-4 md:p-8 flex flex-col gap-6">
        
        <!-- Header -->
        <header class="flex items-center justify-between border-b border-slate-800 pb-4">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-amber-500 rounded flex items-center justify-center shadow-lg shadow-amber-500/20">
                    <i data-lucide="database" class="w-7 h-7 text-black"></i>
                </div>
                <div>
                    <h1 class="text-2xl md:text-3xl font-black uppercase tracking-tighter leading-none drop-shadow-[0_0_8px_rgba(245,158,11,0.3)]">
                        FRACTION <span class="text-amber-500">ARCHITECT</span>
                    </h1>
                    <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.4em] mt-1 opacity-70">Tactical Logic // Module_0<span id="step-num-display">1</span></p>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <div class="hidden md:flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_#22c55e]"></div>
                    <span class="text-[10px] font-bold text-green-500 uppercase tracking-widest">Engine_Active</span>
                </div>
                <div class="h-10 w-[1px] bg-slate-800"></div>
                <div class="text-right">
                    <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Step Progression</div>
                    <div id="step-indicators" class="flex gap-1 mt-1">
                        <div class="h-1.5 w-6 rounded-full bg-amber-500"></div>
                        <div class="h-1.5 w-6 rounded-full bg-slate-800"></div>
                        <div class="h-1.5 w-6 rounded-full bg-slate-800"></div>
                        <div class="h-1.5 w-6 rounded-full bg-slate-800"></div>
                    </div>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Panel -->
            <section class="lg:col-span-4 flex flex-col gap-6">
                <div class="bg-[#161b26] border border-slate-800 rounded-xl p-6 shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-amber-500"></div>
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-6 flex items-center gap-2">
                        <i data-lucide="cpu" class="w-4 h-4"></i> Input Parameters
                    </h3>

                    <div class="flex items-center justify-center gap-4 py-4 bg-black/40 rounded-lg border border-slate-800">
                        <div class="flex flex-col items-center gap-3">
                            <input id="f1n" type="number" value="1" class="w-14 h-14 text-center text-xl font-black bg-[#0a0e14] border border-slate-700 rounded-lg text-amber-500 outline-none focus:border-amber-500">
                            <div class="w-16 h-[2px] bg-slate-700"></div>
                            <input id="f1d" type="number" value="2" class="w-14 h-14 text-center text-xl font-black bg-[#0a0e14] border border-slate-700 rounded-lg text-amber-500 outline-none focus:border-amber-500">
                        </div>

                        <select id="op-select" class="text-2xl font-black bg-transparent text-slate-400 p-2 appearance-none cursor-pointer hover:text-white">
                            <option value="+">+</option>
                            <option value="-">−</option>
                        </select>

                        <div class="flex flex-col items-center gap-3">
                            <input id="f2n" type="number" value="1" class="w-14 h-14 text-center text-xl font-black bg-[#0a0e14] border border-slate-700 rounded-lg text-amber-500 outline-none focus:border-amber-500">
                            <div class="w-16 h-[2px] bg-slate-700"></div>
                            <input id="f2d" type="number" value="3" class="w-14 h-14 text-center text-xl font-black bg-[#0a0e14] border border-slate-700 rounded-lg text-amber-500 outline-none focus:border-amber-500">
                        </div>
                    </div>

                    <button id="init-btn" onclick="startAnalysis()" class="w-full mt-6 bg-slate-200 hover:bg-white text-black font-black py-4 rounded-lg uppercase tracking-widest text-xs transition-all active:scale-95 shadow-lg">
                        Initiate Analysis
                    </button>
                </div>

                <div class="bg-[#161b26] border border-slate-800 rounded-xl p-6 flex-1 shadow-xl">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2">
                        <i data-lucide="terminal" class="w-4 h-4"></i> Logic Breakdown
                    </h3>
                    <div id="logic-text" class="space-y-4 text-[11px] leading-relaxed text-slate-400 italic">
                        <p>> Select operands and operation to begin partitioned analysis.</p>
                    </div>
                </div>
            </section>

            <!-- Workspace -->
            <section class="lg:col-span-8 bg-[#161b26] border border-slate-800 rounded-xl p-8 shadow-2xl relative overflow-hidden min-h-[500px] flex flex-col">
                <div class="absolute top-4 right-6 flex items-center gap-2">
                    <i data-lucide="activity" class="w-4 h-4 text-amber-500"></i>
                    <span class="text-[10px] font-black text-slate-600 uppercase tracking-widest">Workspace_Analysis_Terminal</span>
                </div>

                <div id="workspace-content" class="flex-1 flex flex-col justify-center">
                    <!-- Idle State -->
                    <div id="step-1-ui" class="text-center opacity-20">
                        <i data-lucide="scan" class="w-16 h-16 mx-auto mb-4 text-slate-600 animate-pulse"></i>
                        <p class="uppercase font-bold tracking-widest text-sm">Awaiting Parameter Initialization</p>
                    </div>

                    <!-- Step 2: LCD -->
                    <div id="step-2-ui" class="step-hidden">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-black uppercase mb-2 tracking-tight">Identify <span class="text-amber-500">Base Unit</span></h2>
                            <p class="text-slate-500 text-sm">Find the Lowest Common Multiple (LCD).</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4 max-w-md mx-auto mb-8">
                            <div class="p-4 bg-black/40 border border-slate-800 rounded-lg text-center">
                                <span class="text-[10px] text-slate-500 block mb-2 uppercase font-bold">Base A: <span id="disp-d1"></span></span>
                                <div id="multiples-1" class="text-amber-500 font-bold tracking-tighter text-sm"></div>
                            </div>
                            <div class="p-4 bg-black/40 border border-slate-800 rounded-lg text-center">
                                <span class="text-[10px] text-slate-500 block mb-2 uppercase font-bold">Base B: <span id="disp-d2"></span></span>
                                <div id="multiples-2" class="text-amber-500 font-bold tracking-tighter text-sm"></div>
                            </div>
                        </div>
                        <div class="max-w-xs mx-auto flex gap-2">
                            <input type="number" id="input-lcd" placeholder="LCD" class="flex-1 bg-black border-2 border-slate-800 rounded p-4 text-center font-black text-2xl text-amber-500 focus:border-amber-500 outline-none">
                            <button onclick="checkLCD()" class="bg-amber-500 text-black px-6 font-black uppercase text-xs rounded">Verify</button>
                        </div>
                    </div>

                    <!-- Step 3: Scaling -->
                    <div id="step-3-ui" class="step-hidden">
                        <div class="text-center mb-10">
                            <h2 class="text-3xl font-black uppercase mb-2 tracking-tight">Linear <span class="text-amber-500">Scaling</span></h2>
                            <p class="text-slate-500 text-sm italic">Base shifted to <span class="lcd-val text-amber-500"></span>. Calibrate numerators.</p>
                        </div>
                        <div class="flex flex-col md:flex-row items-center justify-center gap-12">
                            <div class="flex items-center gap-4">
                                <div class="text-center opacity-40">
                                    <div class="text-xl font-bold n1-val"></div>
                                    <div class="w-10 h-0.5 bg-slate-400 mx-auto my-1"></div>
                                    <div class="text-xl font-bold d1-val"></div>
                                </div>
                                <i data-lucide="arrow-right" class="w-6 h-6 text-slate-700"></i>
                                <div class="text-center">
                                    <input type="number" id="input-scale-1" class="w-16 h-12 bg-black border-b-4 border-amber-500 text-center text-2xl font-black text-amber-500 outline-none">
                                    <div class="w-16 h-0.5 bg-slate-500 mx-auto my-2"></div>
                                    <div class="text-2xl font-black text-slate-400 lcd-val"></div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-center opacity-40">
                                    <div class="text-xl font-bold n2-val"></div>
                                    <div class="w-10 h-0.5 bg-slate-400 mx-auto my-1"></div>
                                    <div class="text-xl font-bold d2-val"></div>
                                </div>
                                <i data-lucide="arrow-right" class="w-6 h-6 text-slate-700"></i>
                                <div class="text-center">
                                    <input type="number" id="input-scale-2" class="w-16 h-12 bg-black border-b-4 border-amber-500 text-center text-2xl font-black text-amber-500 outline-none">
                                    <div class="w-16 h-0.5 bg-slate-500 mx-auto my-2"></div>
                                    <div class="text-2xl font-black text-slate-400 lcd-val"></div>
                                </div>
                            </div>
                        </div>
                        <button onclick="checkScaling()" class="mt-12 block mx-auto bg-slate-800 border border-slate-700 px-10 py-3 rounded uppercase font-black text-[10px] tracking-[0.2em] hover:bg-slate-700 transition-colors">Sync Ratios</button>
                    </div>

                    <!-- Step 4: Merge -->
                    <div id="step-4-ui" class="step-hidden">
                        <div class="text-center mb-12">
                            <h2 class="text-3xl font-black uppercase mb-2 tracking-tight">Tactical <span class="text-amber-500">Merge</span></h2>
                            <p class="text-slate-500 text-sm">Operation: <span id="op-name"></span> of calibrated numerators.</p>
                        </div>
                        <div class="flex items-center justify-center gap-6">
                            <div class="flex flex-col items-center">
                                <div class="text-3xl font-black cn1-val"></div>
                                <div class="w-16 h-1 bg-slate-800 my-2"></div>
                                <div class="text-amber-500 font-bold lcd-val"></div>
                            </div>
                            <div class="text-4xl font-black text-slate-600 op-sym"></div>
                            <div class="flex flex-col items-center">
                                <div class="text-3xl font-black cn2-val"></div>
                                <div class="w-16 h-1 bg-slate-800 my-2"></div>
                                <div class="text-amber-500 font-bold lcd-val"></div>
                            </div>
                            <div class="text-4xl font-black text-slate-600">=</div>
                            <div class="flex flex-col items-center">
                                <input type="number" id="input-final" class="w-20 h-16 bg-black border-2 border-amber-500/50 rounded text-center text-4xl font-black text-amber-500 outline-none">
                                <div class="w-20 h-1 bg-slate-800 mt-3"></div>
                                <div class="text-amber-500 font-bold mt-1 lcd-val"></div>
                            </div>
                        </div>
                        <button onclick="checkFinal()" class="mt-12 block mx-auto bg-amber-500 text-black px-12 py-4 rounded font-black uppercase text-xs tracking-widest shadow-lg shadow-amber-500/20 active:scale-95">Complete Computation</button>
                    </div>
                </div>

                <!-- Feedback -->
                <div id="feedback-panel" class="mt-auto p-4 rounded-lg border hidden flex items-start gap-4">
                    <div id="feedback-icon"></div>
                    <div class="flex-1">
                        <p id="feedback-title" class="text-[10px] font-black uppercase tracking-widest mb-1"></p>
                        <p id="feedback-msg" class="text-xs leading-relaxed font-bold"></p>
                        <button id="next-step-btn" onclick="goToNextStep()" class="hidden mt-3 text-[10px] font-black bg-green-500 text-black px-3 py-1 rounded flex items-center gap-1 uppercase">
                            Proceed to next phase <i data-lucide="chevron-right" class="w-3 h-3"></i>
                        </button>
                        <button id="reload-btn" onclick="reset()" class="hidden mt-3 text-[10px] font-black bg-green-500 text-black px-3 py-1 rounded flex items-center gap-1 uppercase">
                            Reload Module <i data-lucide="refresh-ccw" class="w-3 h-3"></i>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="p-4 bg-[#161b26] border border-slate-800 rounded-xl flex items-center justify-between shadow-lg">
            <button onclick="goBack()" id="back-btn" class="text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-white flex items-center gap-2 opacity-0 transition-colors">
                <i data-lucide="chevron-left" class="w-4 h-4"></i> Previous_State
            </button>
            <div class="flex items-center gap-4 text-[9px] font-black text-slate-700 uppercase tracking-widest">
                <span class="flex items-center gap-1"><div class="w-1.5 h-1.5 rounded-full bg-slate-700"></div> System_vStatic.2</span>
                <span class="flex items-center gap-1"><div class="w-1.5 h-1.5 rounded-full bg-slate-700"></div> Partitioned_Logic</span>
            </div>
            <button onclick="reset()" class="text-[10px] font-black uppercase tracking-widest text-red-500/70 hover:text-red-500 transition-colors">
                Force_Reset
            </button>
        </footer>
    </div>

    <script>
        let state = {
            step: 1,
            f1: { n: 1, d: 2 },
            f2: { n: 1, d: 3 },
            op: '+',
            correctLCD: 6,
            correctN1: 3,
            correctN2: 2,
            finalN: 5
        };

        const gcd = (a, b) => (b === 0 ? a : gcd(b, a % b));
        const lcm = (a, b) => (a * b) / gcd(a, b);

        function startAnalysis() {
            state.f1.n = parseInt(document.getElementById('f1n').value) || 0;
            state.f1.d = parseInt(document.getElementById('f1d').value) || 1;
            state.f2.n = parseInt(document.getElementById('f2n').value) || 0;
            state.f2.d = parseInt(document.getElementById('f2d').value) || 1;
            state.op = document.getElementById('op-select').value;

            state.correctLCD = lcm(state.f1.d, state.f2.d);
            state.correctN1 = state.f1.n * (state.correctLCD / state.f1.d);
            state.correctN2 = state.f2.n * (state.correctLCD / state.f2.d);
            state.finalN = state.op === '+' ? state.correctN1 + state.correctN2 : state.correctN1 - state.correctN2;

            // Lock inputs
            ['f1n','f1d','f2n','f2d','op-select'].forEach(id => document.getElementById(id).disabled = true);
            document.getElementById('init-btn').classList.add('hidden');
            
            goToNextStep();
        }

        function goToNextStep() {
            state.step++;
            updateUI();
        }

        function goBack() {
            if (state.step > 1) {
                state.step--;
                updateUI();
            }
        }

        function updateUI() {
            // Hide all steps
            [1,2,3,4].forEach(s => document.getElementById(`step-${s}-ui`).classList.add('step-hidden'));
            document.getElementById(`step-${state.step}-ui`).classList.remove('step-hidden');
            
            // Header
            document.getElementById('step-num-display').innerText = state.step;
            const indicators = document.getElementById('step-indicators').children;
            for(let i=0; i<4; i++) {
                indicators[i].className = `h-1.5 w-6 rounded-full ${state.step > i ? 'bg-amber-500' : 'bg-slate-800'}`;
            }

            // Logic Text
            const logBox = document.getElementById('logic-text');
            const messages = [
                "> Select operands and operation to begin partitioned analysis.",
                `> Denominators ${state.f1.d} and ${state.f2.d} are disparate. Finding Common denominator to align base units.`,
                "> Expanding numerators to maintain ratio integrity during base shift.",
                `> Uniform base established at ${state.correctLCD}. Final merge sequence ready.`
            ];
            logBox.innerHTML = `<p>${messages[state.step-1]}</p>`;

            // Hide Feedback
            document.getElementById('feedback-panel').classList.add('hidden');
            document.getElementById('next-step-btn').classList.add('hidden');
            document.getElementById('reload-btn').classList.add('hidden');

            // Footer
            document.getElementById('back-btn').style.opacity = state.step > 1 ? "1" : "0";

            // Populate specific UI values
            if (state.step === 2) {
                document.getElementById('disp-d1').innerText = state.f1.d;
                document.getElementById('disp-d2').innerText = state.f2.d;
                document.getElementById('multiples-1').innerText = [1,2,3,4,5].map(i => state.f1.d * i).join(' · ');
                document.getElementById('multiples-2').innerText = [1,2,3,4,5].map(i => state.f2.d * i).join(' · ');
            } else if (state.step === 3) {
                document.querySelectorAll('.lcd-val').forEach(el => el.innerText = state.correctLCD);
                document.querySelectorAll('.n1-val').forEach(el => el.innerText = state.f1.n);
                document.querySelectorAll('.d1-val').forEach(el => el.innerText = state.f1.d);
                document.querySelectorAll('.n2-val').forEach(el => el.innerText = state.f2.n);
                document.querySelectorAll('.d2-val').forEach(el => el.innerText = state.f2.d);
            } else if (state.step === 4) {
                document.querySelectorAll('.lcd-val').forEach(el => el.innerText = state.correctLCD);
                document.querySelectorAll('.cn1-val').forEach(el => el.innerText = state.correctN1);
                document.querySelectorAll('.cn2-val').forEach(el => el.innerText = state.correctN2);
                document.querySelectorAll('.op-sym').forEach(el => el.innerText = state.op);
                document.getElementById('op-name').innerText = state.op === '+' ? 'Summation' : 'Difference';
            }
            
            lucide.createIcons();
        }

        function showFeedback(type, msg) {
            const panel = document.getElementById('feedback-panel');
            const title = document.getElementById('feedback-title');
            const text = document.getElementById('feedback-msg');
            const icon = document.getElementById('feedback-icon');

            panel.classList.remove('hidden', 'bg-green-500/10', 'border-green-500/30', 'text-green-500', 'bg-red-500/10', 'border-red-500/30', 'text-red-500');
            
            if (type === 'success') {
                panel.classList.add('bg-green-500/10', 'border-green-500/30', 'text-green-500');
                title.innerText = 'SUCCESS';
                icon.innerHTML = '<i data-lucide="check-circle-2" class="w-5 h-5"></i>';
                if (state.step < 4) document.getElementById('next-step-btn').classList.remove('hidden');
                else document.getElementById('reload-btn').classList.remove('hidden');
            } else {
                panel.classList.add('bg-red-500/10', 'border-red-500/30', 'text-red-500');
                title.innerText = 'ERROR';
                icon.innerHTML = '<i data-lucide="alert-circle" class="w-5 h-5"></i>';
            }
            text.innerText = msg;
            lucide.createIcons();
        }

        function checkLCD() {
            const val = parseInt(document.getElementById('input-lcd').value);
            if (val === state.correctLCD) {
                showFeedback('success', 'CORE_SYNC_SUCCESS: Lowest Common Multiple identified.');
            } else if (val % state.f1.d === 0 && val % state.f2.d === 0) {
                showFeedback('success', 'VALID_DENOMINATOR: Functional, but efficiency is sub-optimal (not LCD).');
            } else {
                showFeedback('error', `SYNC_ERROR: Values ${state.f1.d} and ${state.f2.d} do not divide into ${val || '?'}.`);
            }
        }

        function checkScaling() {
            const v1 = parseInt(document.getElementById('input-scale-1').value);
            const v2 = parseInt(document.getElementById('input-scale-2').value);
            if (v1 === state.correctN1 && v2 === state.correctN2) {
                showFeedback('success', 'SCALING_COMPLETE: Ratios verified and synchronized.');
            } else {
                showFeedback('error', 'CALIBRATION_FAILED: Check multiplication for numerator alignment.');
            }
        }

        function checkFinal() {
            const val = parseInt(document.getElementById('input-final').value);
            if (val === state.finalN) {
                showFeedback('success', 'COMPUTATION_SUCCESS: Final result validated.');
            } else {
                showFeedback('error', 'ARITHMETIC_MISMATCH: Final numerator calculation is incorrect.');
            }
        }

        function reset() {
            state.step = 1;
            ['f1n','f1d','f2n','f2d','op-select'].forEach(id => document.getElementById(id).disabled = false);
            document.getElementById('init-btn').classList.remove('hidden');
            ['input-lcd', 'input-scale-1', 'input-scale-2', 'input-final'].forEach(id => document.getElementById(id).value = '');
            updateUI();
        }

        window.onload = () => lucide.createIcons();
    </script>
</body>
</html>
